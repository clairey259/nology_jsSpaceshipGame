"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = getModuleName;
{
  var originalGetModuleName = getModuleName;

  exports["default"] = getModuleName = function getModuleName(rootOpts, pluginOpts) {
    var _pluginOpts$moduleId, _pluginOpts$moduleIds, _pluginOpts$getModule, _pluginOpts$moduleRoo;

    return originalGetModuleName(rootOpts, {
      moduleId: (_pluginOpts$moduleId = pluginOpts.moduleId) != null ? _pluginOpts$moduleId : rootOpts.moduleId,
      moduleIds: (_pluginOpts$moduleIds = pluginOpts.moduleIds) != null ? _pluginOpts$moduleIds : rootOpts.moduleIds,
      getModuleId: (_pluginOpts$getModule = pluginOpts.getModuleId) != null ? _pluginOpts$getModule : rootOpts.getModuleId,
      moduleRoot: (_pluginOpts$moduleRoo = pluginOpts.moduleRoot) != null ? _pluginOpts$moduleRoo : rootOpts.moduleRoot
    });
  };
}

function getModuleName(rootOpts, pluginOpts) {
  var filename = rootOpts.filename,
      _rootOpts$filenameRel = rootOpts.filenameRelative,
      filenameRelative = _rootOpts$filenameRel === void 0 ? filename : _rootOpts$filenameRel,
      _rootOpts$sourceRoot = rootOpts.sourceRoot,
      sourceRoot = _rootOpts$sourceRoot === void 0 ? pluginOpts.moduleRoot : _rootOpts$sourceRoot;
  var moduleId = pluginOpts.moduleId,
      _pluginOpts$moduleIds2 = pluginOpts.moduleIds,
      moduleIds = _pluginOpts$moduleIds2 === void 0 ? !!moduleId : _pluginOpts$moduleIds2,
      getModuleId = pluginOpts.getModuleId,
      _pluginOpts$moduleRoo2 = pluginOpts.moduleRoot,
      moduleRoot = _pluginOpts$moduleRoo2 === void 0 ? sourceRoot : _pluginOpts$moduleRoo2;
  if (!moduleIds) return null;

  if (moduleId != null && !getModuleId) {
    return moduleId;
  }

  var moduleName = moduleRoot != null ? moduleRoot + "/" : "";

  if (filenameRelative) {
    var sourceRootReplacer = sourceRoot != null ? new RegExp("^" + sourceRoot + "/?") : "";
    moduleName += filenameRelative.replace(sourceRootReplacer, "").replace(/\.(\w*?)$/, "");
  }

  moduleName = moduleName.replace(/\\/g, "/");

  if (getModuleId) {
    return getModuleId(moduleName) || moduleName;
  } else {
    return moduleName;
  }
}